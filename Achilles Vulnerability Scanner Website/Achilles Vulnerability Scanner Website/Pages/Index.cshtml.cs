using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;
using MySql.Data.MySqlClient;
using System.Data;

namespace Achilles_Vulnerability_Scanner_Website.Pages
{
    public class IndexModel : PageModel
    {
        private readonly ILogger<IndexModel> _logger;

        public IndexModel(ILogger<IndexModel> logger)
        {
            _logger = logger;
        }

        public class QSData
        {
            public string QSID { get; set; }
            public string ScanIP { get; set; }
            public string ScanVendor { get; set; } 
            public string ScanOS { get; set; }
            public string ScanOSFamily { get; set; }
            public string ScanMAC { get; set; } 
            public string ScanHostname { get; set; }
            public string ScanPorts { get; set; }
            public string ScanPortServices { get; set; } 
            public string ClosedPort { get; set; } 
            public string ScanCompletionTime { get; set; }
        }

        public void OnGet()
        {
            MySqlConnection conn = new MySqlConnection("server=localhost;database=scannerdbmk3;uid=root;pwd=C4bbages!;AllowUserVariables=True;");
            string cmdString = "SELECT * FROM scannerdbmk3.quickscandata";
            List<QSData> QuickData = new List<QSData>();
            MySqlCommand cmd = new MySqlCommand(cmdString, conn);
            MySqlDataReader reader = cmd.ExecuteReader();

            try
            {
                conn.Open();
                cmd.CommandText = cmdString;
                reader = cmd.ExecuteReader();
                while (reader.Read())
                {
                    QuickData.Add(new QSData()
                    {
                        QSID = reader["QSID"].ToString(),
                        ScanIP = reader["ScanIP"].ToString(),
                        ScanVendor = reader["ScanVendor"].ToString(),
                        ScanOS = reader["ScanOS"].ToString(),
                        ScanOSFamily = reader["ScanOSFamily"].ToString(),
                        ScanMAC = reader["ScanMAC"].ToString(),
                        ScanHostname = reader["ScanHostname"].ToString(),
                        ScanPorts = reader["ScanPorts"].ToString(),
                        ScanPortServices = reader["ScanPortServices"].ToString(),
                        ClosedPort = reader["ClosedPort"].ToString(),
                        ScanCompletionTime = reader["ScanCompletionTime"].ToString(),
                    });
                }
                conn.Close();
            }
            catch (Exception ex)
            {

            }
            //var model = new List<Student>();
            //using (MySqlCommand command = new MySqlCommand(cmdString, conn))
            //{
            //    conn.Open();
            //    MySqlDataReader rdr = cmd.ExecuteReader();
            //    while (rdr.Read())
            //    {
            //        var QSData = new GetQSData();
            //        QSData.QSID = rdr["QSID"];

            //    }
            //}
        }
    }
}